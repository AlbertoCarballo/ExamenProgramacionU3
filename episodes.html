<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="./episodes.css">
</head>

<body>

    <div id="main">
        <div class="contenedor-supremo">
            <div class="nav-bar">
                <nav class="navbar navbar-expand-lg" data-bs-theme="dark">
                    <div class="container-fluid">
                        <a class="navbar-brand" href="#">Navbar</a>
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false"
                            aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNavDropdown">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link active" aria-current="page" @click="redirectHome">Home</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Features</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Pricing</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                                        aria-expanded="false">
                                        Dropdown link
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#">Action</a></li>
                                        <li><a class="dropdown-item" href="#">Another action</a></li>
                                        <li><a class="dropdown-item" href="#">Something else here</a></li>
                                    </ul>
                                </li>
                            </ul>
                            <div class="logout-button" style="margin-left: auto;">
                                <button @click="logout">Log Out</button>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
            <div class="season-container" v-for="episode in episodes">
                <div class="image">
                    <img v-bind:src="'https://media.themoviedb.org/t/p/w440_and_h660_face/' + episode.still_path"
                        v-bind:alt="episode.name">
                </div>
                <div class="info">
                    <h2>{{episode.name}}</h2>
                    <p>{{ episode.air_date }} â€¢ Episodio {{episode.episode_number}} </p>
                    <p class="release-date">Temporada {{episode.season_number}} </p>
                    <span>
                        Sinopsis:
                        <br>
                        {{episode.overview}}
                        <br>
                        <button @click="redirectGuestStars(episode)">Ver Estrellas Invitadas </button>
                    </span>
                </div>
            </div>
        </div>
    </div>


    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        const { createApp, ref } = Vue

        createApp({
            setup() {

                const name_app = ref('Mi primer app')
                const episodes = ref([]);
                const title = ref("")

                return {
                    name_app,
                    episodes,
                    title
                }

            },
            methods: {
                redirectGuestStars(episode) {
                    const urlParams = new URLSearchParams(window.location.search)
                    const idPelicula = urlParams.get('id')

                    const myHeaders = new Headers();
                    myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIwNmYxN2MyZGEyMDQ5Njg0ZTRjYmJmOTE1YmI3ZmE5MSIsIm5iZiI6MTcyODQyMDc0Ny45MjIzMDUsInN1YiI6IjY3MDU5OTM4ZjRiOTE5ZjgzOTc3OGJmNCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.P2ljJ6l49mdKja0Fj5G-9mQ0CJcJKah8c_KjT_U2OVw");

                    const requestOptions = {
                        method: "GET",
                        headers: myHeaders,
                        redirect: "follow"
                    };

                    fetch(`https://api.themoviedb.org/3//tv/${idPelicula}/season/${episode.season_number}/episode/${episode.episode_number}?language=en-US`, requestOptions)
                        .then((response) => response.json())
                        .then((result) => {
                            if (!result.guest_stars.length == 0) {
                                window.location.href = `estrellasInvitadas.html?id=${idPelicula}&season=${episode.season_number}&episode=${episode.episode_number}`;
                            } else {
                                alert("no hay estrellas invitadas")
                            }
                        })
                        .catch((error) => console.error(error));

                },
                redirectHome() {
                    window.location.href = `home.html`;
                },
                logout() {
                    localStorage.clear();
                    window.location.href = "index.html";
                }


            },
            mounted() {
                const urlParams = new URLSearchParams(window.location.search)
                const idPelicula = urlParams.get('id')
                const urlParamers = new URLSearchParams(window.location.search)
                const seasonNumber = urlParamers.get('season')
                let is_log = localStorage.getItem("is_log");
                let username = localStorage.getItem("username");
                const session = localStorage.getItem("session");

                if (is_log == null && username == null) {
                    window.location.href = "index.html";
                }

                const myHeaders = new Headers();
                myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIwNmYxN2MyZGEyMDQ5Njg0ZTRjYmJmOTE1YmI3ZmE5MSIsIm5iZiI6MTcyODQyMDc0Ny45MjIzMDUsInN1YiI6IjY3MDU5OTM4ZjRiOTE5ZjgzOTc3OGJmNCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.P2ljJ6l49mdKja0Fj5G-9mQ0CJcJKah8c_KjT_U2OVw");

                const requestOptions = {
                    method: "GET",
                    headers: myHeaders,
                    redirect: "follow"
                };

                fetch(`https://api.themoviedb.org/3//tv/${idPelicula}/season/${seasonNumber}?language=en-US`, requestOptions)
                    .then((response) => response.json())
                    .then((result) => {
                        this.episodes = result.episodes
                        console.log(this.episodes)
                    })
                    .catch((error) => console.error(error));



            }
        }).mount('#main') 
    </script>
</body>

</html>